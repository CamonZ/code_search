# code_search

A CLI tool for querying Elixir/Erlang call graph data stored in CozoDB. Designed for LLMs to efficiently explore and understand codebases without consuming context windows by reading source files directly.

## Why?

When LLMs analyze codebases, they typically read source files one by one, quickly exhausting their context window. This tool provides structured queries over pre-extracted call graph data, allowing LLMs to:

- Find function definitions and their locations
- Trace call chains (who calls what, and who calls them)
- Discover module dependencies
- Identify unused code and hotspots
- Search by pattern without reading files

One query can answer questions that would otherwise require reading dozens of files.

## Installation

```bash
cargo build --release
```

## Usage

First, import a call graph JSON file (generated by an Elixir analyzer):

```bash
code_search import -f call_graph.json
```

Then query the data:

```bash
# Find where a function is defined
code_search location -m MyApp.Accounts -f get_user

# What does this function call?
code_search calls-from -m MyApp.Accounts -f get_user

# Who calls this function?
code_search calls-to -m MyApp.Repo -f get

# Trace the full call chain from a function
code_search trace -m MyApp.Web.UserController -f show

# Find a path between two functions
code_search path --from MyApp.Web.UserController.show --to MyApp.Repo.get

# Find unused functions
code_search unused --public-only

# Find hotspots (most called functions)
code_search hotspots -k incoming -l 10
```

## Output Formats

- `--format table` (default): Human-readable output
- `--format json`: Structured JSON for programmatic use
- `--format toon`: Token-optimized format for LLM consumption

## Commands

| Command | Description |
|---------|-------------|
| `import` | Import call graph JSON into the database |
| `search` | Search modules/functions by name pattern |
| `location` | Find function definition location (file:line) |
| `calls-from` | What a function calls (outgoing edges) |
| `calls-to` | What calls a function (incoming edges) |
| `function` | Show function signature (args, return type) |
| `struct` | Show struct fields and types |
| `trace` | Forward call chain traversal |
| `reverse-trace` | Backward call chain traversal |
| `path` | Find call path between two functions |
| `depends-on` | Module's outgoing dependencies |
| `depended-by` | Module's incoming dependencies |
| `unused` | Find uncalled functions |
| `hotspots` | Find high fan-in/fan-out functions |
| `file` | List functions in a file |

## Architecture

- Written in Rust using clap for CLI parsing
- Uses CozoDB (SQLite-backed) for graph queries
- Call graph data is extracted separately by an Elixir analyzer
- Supports multiple projects in the same database via `--project` flag
